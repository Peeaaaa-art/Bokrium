<% content_for :title, "本棚 - Bokrium" %>

<% if !user_signed_in? %>
  <div class="alert alert-info text-center">
    こちらはサンプル表示です。自分の本棚を作成するには、ログイン・アカウント登録が必要です。
  </div>
<% end %>

<% if @no_books %>
  <div class="alert alert-info text-center">
    <p>こちらはサンプル表示です。最初の本を登録しましょう！</p>
    <div class="mt-3">
      <%= link_to "新規書籍登録", search_books_path, class: "btn btn-primary" %>
    </div>
  </div>
<% end %>

<% if user_signed_in? && !@no_books %>
<!-- app/views/books/index.html.erb など -->
<div class="mb-3 d-flex gap-2">
  <%= link_to "📚 棚ビュー", books_path(view: "shelf"), class: "btn btn-sm #{'btn-primary' if @view_mode == 'shelf'}" %>
  <%= link_to "🧾 カードビュー", books_path(view: "card"), class: "btn btn-sm #{'btn-primary' if @view_mode == 'card'}" %>
</div>
  <!-- 検索・タグ・ソートトグル 横並び -->
<div class="d-flex justify-content-center mt-3 mt-md-5 mb-3">
  <div class="filter-controls border rounded-pill shadow-sm px-4 py-2 d-flex align-items-center gap-3">
    <!-- 検索 -->
    <button class="btn btn-icon" data-bs-toggle="collapse" data-bs-target="#searchCollapse" aria-expanded="false">
      <i class="bi bi-search icon-refined"></i>
    </button>

    <!-- ソート -->
    <button class="btn btn-icon" data-bs-toggle="collapse" data-bs-target="#sortCollapse" aria-expanded="false">
      <i class="bi bi-filter icon-refined"></i>
    </button>

    <!-- タグ -->
    <button class="btn btn-icon" data-bs-toggle="collapse" data-bs-target="#tagCollapse" aria-expanded="false">
      <i class="bi bi-tags icon-refined"></i>
    </button>
  </div>
</div>

  <!-- 📦 下の行：トグルで展開される内容（初期は非表示） -->
  <div class="">
    <!-- 検索フォーム -->
    <div class="collapse mb-2" id="searchCollapse">
      <%= render "shared/search_bar", scope: "mine", placeholder: "自分の本やメモを検索" %>
    </div>

    <!-- ソート -->
    <div class="collapse mb-2" id="sortCollapse">
      <%= render "sort_controls", filtered_tag: @filtered_tag, current_sort: params[:sort] %>
    </div>

    <!-- タグ -->
    <div class="collapse mb-2" id="tagCollapse"
          data-controller="tag-toggle"
          data-tag-toggle-selected-tags-value="<%= @filtered_tags&.join(',') %>">
      <%= render "tag_filter", filtered_tags: @filtered_tags %>
    </div>
  </div>

  <turbo-frame id="books_frame">
    <%= render partial: "books/books_frame", locals: { books: @books } %>
  </turbo-frame>
<% end %>

<% if @no_books || !user_signed_in? %>
  <%= render partial: "bookshelf/sample_books", locals: { books: @books } %>
<% end %>

<% if !user_signed_in? %>
  <div class="registration-cta text-center mt-5 text-dark fw-bold  big-shoulders-inline-bold">
    <h4>あなたの読書体験をもっと豊かに</h4>
    <p>Bokriumで読書メモを管理し、知識を整理しましょう</p>
    <%= link_to "今すぐ始める（無料登録）", new_user_registration_path, class: "btn btn-lg btn-success mt-2 mb-5" %>
  </div>
<% end %>