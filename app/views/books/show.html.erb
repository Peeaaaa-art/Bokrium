<% content_for :title, "Ë™≠Êõ∏„É°„É¢ - Bokrium" %>

<div class="container my-5" style="max-width: 1200px;">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Ê®™‰∏¶„Å≥„ÅÆ„É¨„Ç§„Ç¢„Ç¶„ÉàÔºöÊõ∏ÂΩ±ÔºãÊÉÖÂ†± -->
      <div class="row g-4 align-items-start">
        <!-- Êõ∏ÂΩ±ÔºöÂ∑¶ÂçäÂàÜ -->
        <div class="col-6 d-flex justify-content-center">
          <div class="book-cover-show">
            <% if @book.book_cover_s3.attached? %>
              <%= image_tag @book.book_cover_s3, alt: @book.title,
                  class: "img-fluid rounded shadow-sm",
                  style: "max-width: 160px; max-height: 240px; object-fit: contain;" %>
            <% elsif @book.book_cover.present? %>
              <img src="<%= @book.book_cover %>" alt="Ë°®Á¥ôÁîªÂÉè"
                  class="img-fluid rounded shadow-sm"
                  style="max-width: 160px; max-height: 240px; object-fit: contain;">
            <% else %>
              <div class="no-cover text-muted d-flex align-items-center justify-content-center rounded"
                  style="width: 160px; height: 240px;">
                <%= @book.title.truncate(20) %>
              </div>
            <% end %>
          </div>
        </div>

        <!-- ÊÉÖÂ†±ÔºöÂè≥ÂçäÂàÜ -->
        <div class="col-6">
          <div class="card border-0 shadow-none bg-transparent h-100">
            <div class="fw-bold fs-6 mb-2"><%= @book.title %></div>
              <ul class="list-unstyled small text-secondary mb-0 lh-2">
                <% if @book.author.present? %>
                  <li><i class="bi bi-person"></i> <%= @book.author %></li>
                <% end %>
                <% if @book.publisher.present? %>
                  <li><i class="bi bi-building"></i> <%= @book.publisher %></li>
                <% end %>
                <% if @book.isbn.present? %>
                  <li><i class="bi bi-upc"></i> <%= @book.isbn %></li>
                <% end %>
                <% if @book.page.present? %>
                  <li><i class="bi bi-file-earmark-text"></i> <%= @book.page %> „Éö„Éº„Ç∏</li>
                <% end %>
                <% if @book.price.present? %>
                  <li><i class="bi bi-currency-yen"></i> <%= @book.price %></li>
                <% end %>
              </ul>
          </div>
        </div>
      </div>


      <div class="d-flex flex-row align-items-center justify-content-between  filter-controls border rounded-pill shadow-sm px-3 mt-3">
        <!-- „Çø„Ç∞ -->
        <button class="btn btn-sm text-white" data-bs-toggle="modal" data-bs-target="#tagSelectModal">
            <i class="bi bi-tags fs-5 icon-refined"></i>
        </button>
        <% content_for :modals do %>
          <%= render "tags/tag_modals", book: @book, user_tags: @user_tags %>
        <% end %>
        <!-- ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
        <div data-controller="image-upload">
          <%= form_with model: [@book, Image.new], local: false,
                html: {
                  multipart: true,
                  class: "d-inline",
                  data: { image_upload_target: "form" }
                } do |f| %>
            <%= f.file_field :image_path,
                  direct_upload: true,
                  class: "d-none",
                  data: {
                    image_upload_target: "fileInput",
                    action: "change->image-upload#triggerUpload"
                  },
                  id: "customFileInputSm" %>
            <label for="customFileInputSm" class="btn btn-sm text-white mb-0">
              <i class="bi bi-camera icon-refined fs-5"></i>
            </label>
          <% end %>
        </div>
        <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥Ôºö„ÇÆ„Ç¢„Éú„Çø„É≥ -->
        <button class="btn btn-sm text-white" type="button" data-bs-toggle="modal" data-bs-target="#settingsModal">
          <i class="bi bi-gear fs-5 icon-refined"></i>
        </button>
        <% content_for :modals do %>
          <%= render "books/modal_edit_destroy", book: @book %>
        <% end %>
        <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Çª„É¨„ÇØ„Éà -->
        <%= form_with(model: @book, local: false, class: "status-form mb-0") do |f| %>
          <%= f.select :status,
                Book.statuses.keys.map { |s| [t("books.status.#{s}"), s] },
                {},
                class: "btn text-gray",
                style: "height: calc(2em + .1rem + 3px);",
                onchange: "this.form.requestSubmit();" %>
        <% end %>
      </div>

      <!-- „Çø„Ç∞ -->
      <div class="px-1 pt-1">
        <%= render "tags/tag_badge_list", book: @book %>
      </div>
      <!-- ÁîªÂÉè„É™„Çπ„Éà -->
      <div class="row row-cols-4 row-cols-md-6 g-2 mb-4" id="image-list">
        <% @book.images.each_with_index do |image, identifier| %>
          <div class="col">
            <%= render "images/card", image:, identifier:, book: @book, thumb: true %>
          </div>
        <% end %>
      </div>
      <!-- „É°„É¢Ë°®Á§∫ -->
      <% if @memos.present? %>
        <% @memos.first&.tap do |memo| %>
          <%= render "memos/read_only_item", book: @book, memo: memo %>
        <% end %>

        <%= render partial: "memos/read_only_item", collection: @memos.drop(1).compact, as: :memo, locals: { book: @book } %>
      <% else %>
        <!-- Êñ∞Ë¶è„É°„É¢„ÅÆ read_only Ë°®Á§∫Ôºà„Åæ„Å†‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÁä∂ÊÖãÔºâ -->
        <%= render "memos/read_only_item", book: @book, memo: @new_memo %>
      <% end %>
      <!-- üìå ÂÖ±ÈÄö„ÅÆ„É¢„Éº„ÉÄ„É´„ÅØ1ÂÄã„Å†„Åë -->
      <%= render "memos/modal_shared", memo: @new_memo %>
      <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
      <div class="d-flex justify-content-center gap-3 mt-4 mb-3">
        <!-- Êñ∞Ë¶è„É°„É¢‰ΩúÊàê„Éú„Çø„É≥ -->
        <%= button_tag type: "button", class: "btn btn-outline-primary", data: {
          controller: "memo-modal",
          action: "click->memo-modal#open",
          memo_modal_memo_id_value: "new",
          memo_modal_book_id_value: @book.id
        } do %>
          <i class="bi bi-pen"></i> „ÇÇ„Å£„Å®Êõ∏„Åè
        <% end %>
        <%= link_to "Êàª„Çã", books_path, class: "btn btn-outline-secondary" %>
      </div>
    </div>
  </div>
</div>

<div id="modal-container"></div>