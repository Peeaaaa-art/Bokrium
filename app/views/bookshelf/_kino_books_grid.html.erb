<div class="books-grid" data-controller="book-shelf">
  <% books.each_slice(books_per_row) do |row_books| %>
    <div class="shelf-row">
      <div class="book-row">
        <% row_books.each do |book| %>
          <div class="book-on-shelf">
            <%= link_to book_path(book), data: { turbo_frame: "_top" } do %>
              <% if book.book_cover_s3.attached? %>
                <%= image_tag book.book_cover_s3.variant(resize_to_limit: [180, 270]),
                      alt: book.title, class: "book-cover" %>
              <% elsif book.book_cover.present? %>
                <img src="<%= book.book_cover %>" alt="表紙画像" class="book-cover">
              <% else %>
                <div class="no-cover"><%= book.title %></div>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="shelf-bar"></div>
    </div>
  <% end %>
</div>

<%= debug books_per_row %>