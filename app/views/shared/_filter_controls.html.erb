<!-- üéØ ‰∏≠Â§ÆÔºö„Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥Áæ§ -->
<div class="mx-auto">
  <div class="filter-controls border rounded-pill shadow-sm px-4 py-md-2 py-1 d-flex align-items-center gap-3">
    <!-- Ê§úÁ¥¢ -->
    <button class="btn btn-icon" data-bs-toggle="collapse" data-bs-target="#searchCollapse" aria-expanded="false">
      <%= bi_icon("search", css: "icon-refined is-5") %>
    </button>

    <!-- „ÇΩ„Éº„Éà -->
    <button class="btn btn-icon" data-bs-toggle="collapse" data-bs-target="#sortCollapse" aria-expanded="false">
      <%= bi_icon("arrow-down-up", css: "icon-refined is-5") %>
    </button>

    <!-- „Çø„Ç∞ -->
    <button class="btn btn-icon" data-bs-toggle="collapse" data-bs-target="#tagCollapse" aria-expanded="false">
      <%= bi_icon("tags", css: "icon-refined is-5") %>
    </button>

    <!-- „Çπ„ÉÜ„Éº„Çø„Çπ -->
    <button class="btn btn-icon" data-bs-toggle="collapse" data-bs-target="#statusCollapse" aria-expanded="false">
      <%= bi_icon("journal-check", css: "icon-refined is-5") %>
    </button>
  </div>
</div>

<!-- „ÇØ„É™„Ç¢„Éú„Çø„É≥ -->
<div class="flex-shrink-0">
  <% clear_path = context == "guest" ? clear_filters_guest_books_path : clear_filters_books_path %>
  <% if session.to_h.slice("sort", "status", "memo_visibility", "tags", "view").values.any?(&:present?) %>
    <%= button_to clear_path,
                  method: :delete,
                  class: "btn btn-light border shadow-sm d-flex align-items-center justify-content-center bookshelf-icon",
                  title: "„ÇØ„É™„Ç¢" do %>

      <%= bi_icon("x-circle", css: "is-5 icon-refined bi-icon-hover") %>
    <% end %>
  <% else %>
    <div class="btn btn-light border shadow-sm d-flex align-items-center justify-content-center bookshelf-icon invisible">
      <%= bi_icon("x-circle", css: "is-5 icon-refined bi-icon-hover") %>
    </div>
  <% end %>
</div>
</div>

<!-- üì¶ ‰∏ã„ÅÆË°åÔºö„Éà„Ç∞„É´„ÅßÂ±ïÈñã„Åï„Çå„ÇãÂÜÖÂÆπ -->
<!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É† -->
<div class="collapse mb-2" id="searchCollapse">
  <%= render "shared/filters/search_bar", scope: context, placeholder: context == "guest" ? "„Çø„Ç§„Éà„É´„ÉªËëóËÄÖÂêç„ÅßÊ§úÁ¥¢" : "Êú¨„ÇÑ„É°„É¢„ÇíÊ§úÁ¥¢", view_mode: view_mode %>
</div>

<!-- „ÇΩ„Éº„Éà -->
<div class="collapse mb-2" id="sortCollapse">
  <%= render "shared/filters/sort_controls", filtered_tag: filtered_tag, current_sort: params[:sort], view_mode: view_mode %>
</div>

<!-- „Çø„Ç∞ -->
<div class="collapse mb-2" id="tagCollapse"
    data-controller="tag-toggle"
    data-tag-toggle-selected-tags-value="<%= filtered_tags&.join(',') %>">
  <turbo-frame id="tag_filter_frame"
               src="<%= context == 'guest' ? filter_tags_guest_books_path : filter_books_tags_path %>">
    Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶
  </turbo-frame>
</div>

<!-- „Çπ„ÉÜ„Éº„Çø„Çπ -->
<div class="collapse mb-2" id="statusCollapse">
  <%= render "shared/filters/status_filter", current_status: filtered_status, view_mode: view_mode %>
</div>